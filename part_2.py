from collections import deque, defaultdict

def bfs_initial_reachable_positions(mars_map):
    rows = len(mars_map)
    cols = len(mars_map[0])
    directions = [(-1, 0), (1, 0), (0, -1), (0, 1)]
    
    # Find the starting position
    start = None
    for r in range(rows):
        for c in range(cols):
            if mars_map[r][c] == 'S':
                start = (r, c)
                break
        if start:
            break
    
    # BFS setup
    queue = deque([(start[0], start[1])])
    visited = set()
    visited.add((start[0], start[1]))
    
    # BFS loop
    reachable_positions = defaultdict(set)
    reachable_positions[0].add((start[0], start[1]))
    
    steps = 0
    while queue:
        steps += 1
        for _ in range(len(queue)):
            x, y = queue.popleft()
            for dx, dy in directions:
                nx, ny = (x + dx) % rows, (y + dy) % cols
                if mars_map[nx][ny] == '.' and (nx, ny) not in visited:
                    visited.add((nx, ny))
                    queue.append((nx, ny))
                    reachable_positions[steps % (rows * cols)].add((nx, ny))
    
    return reachable_positions, rows, cols

def count_reachable_positions(mars_map, total_steps):
    reachable_positions, rows, cols = bfs_initial_reachable_positions(mars_map)
    
    final_positions = set()
    
    # Determine the effective step count within one period
    effective_steps = total_steps % (rows * cols)
    
    for pos in reachable_positions[effective_steps]:
        final_positions.add(pos)
    
    return len(final_positions)

# Example mars map
mars_map = [
" ..................................................................................................................................."
"...##......#....#...#.....#.#....#...#...#...#......#........................##......#..#..#.#........#....................##......"
"...#.......#..........#..#....#................#...##.....##...................#..........###......#.....#.........#....#.#........"
"........#..##.............#..#...##...#..#...##...............................#.........................#.........................."
"..............#............#..#..........#.#.#....#...#......................#..#......#.##...#............................#......."
"..##...............#...#...#......#.......................................#..............##...............#.....#...........#...#.."
".##............#.................#...#..#......#...................................#.......#.#..#......##................##........"
"......###...#...#........#..............#....#.......##.......................##.......#..#.......#.........#...................#.."
".................#...........................................#......................#.....#.....##...........#...............#....."
"..#...#....#.......##...........#..#.............#............................##........#.......#...#...#...#....#....##..........."
"..............#..#.....#.....#.........#..#..#..#..#.......#.#..#....##........#.....#.........#..............#........#..#...#...."
"...##...............#...#.#....#............##..#.......................................#.......#...........#..#...........##....#."
".......................................#......#...........#..........#.............#..........##.............#....#..##....#......."
"..................................#.............#........#...#.##.....................#....................#.##....#.............#."
".#......##...#......#..#...#...........#...#.............#.............#..#.........#..#.#........#.#...........#.................."
"............#............#..........#........#..........#.....#.#...#.......#........#.#...........#....#.............#.........#.."
".....#.......##............#...#.#.#...#...#..............##..#....#......#......................#...#...#..........#......#.#....."
"........#....#....#......#..........#........................#.....#....................................#.....#....#..##.##....#..."
"............#.................#.##.........#.........#.....#........#.........#........#....###...........#.............#.........."
"....##....#..#............#...#.#..#.........................#.#....##.....................#........#.........#....#....#........#."
"...#...#...........#..#..................#.......#.#..#............................................##................#............."
"...........#......#....#........#.#..........................#.#......#......##.............#..#...#...#.#..................#..#..."
".............................#........#............#........#........#.#.......#...............##....#........#...#..#..#.........."
"..................................#...........................#.#..#.........................#...#.#......#..............##.....##."
"........................#..........................#..................#...#............................#.......#...........#...##.."
".......#.#.....#....#.....#................................##...#.........##..#.....................#.............................."
"......#........##..........#.................#..##......#..#.......#..........#...................................................."
"....#..........#......................................................##.#..#.#.##..................#......#............##...#....."
".............#..........#.#..............................................#.#........#....#...........#.......................#....."
"..#.............#....#........#.#..............#.......#......#.#..#......#.#...........................................##........."
"..#.....#.....#....#...#....#..........#......#..............................#...........#............#..#.....##..........#......."
"......#.#.#...#........................#..........#.#......#............#......................................#..................."
".#...........#...#....................#..#..#....#.#........................................................................#.#...."
"........#.#...........................#...#......#.#.#..#......##..#.#..#..#...#.#.#..................#.......##.#....#........#..."
"......#......#......#.....#..............#.#.........##.................#....................#............#....##........#........."
"........#.............#..#............#......#........#....#............#.....#...........#..#...............###........#.....#...."
".....#.........##....#..................#..#...........#.#....##...........................#.............#..##..#.........#........"
"............#....#..#.................#.............#..#.....##.....#.....#.........#........#............#........#.........##...."
".#.......#.#..........#...............#..............#.....#........#...#......#......##...........................#..#.#......##.."
".##.#.........#.............................#............................#.#..#...#.............#...#.........#...#......#........."
"................................#........#..#..........##......#..................................#................#.#...#...#....."
".........#........#...........#........................#.#.##.........#.....#..#................................#.............##..."
".........#.#....#..#.........#.#....#.......#.............#........#............#...#..........#...##..........#........#........#."
"..............................###.....#......#......#...#....#...........#...#...............#.....##.#.....................#..#..."
"..........................#......#...#..............................##.#.......#........##..........#................#...##.....#.."
"...........#............................#..................#...#..#.....................#...#.................................#...."
"..#.#...............................................#..........#..........#..............#............##..........................."
"........#...#..................#.........#............#...............#.#..#.........#....#...............#.............##........."
"............................##....................##......#..#....#.......#....#........................#...#.........#.....#....#."
".....#.#...............#....#..#....#...........#........#.#..................#.....##....#.......#......#......................#.."
"...........#.........#.#.......#......#.#.#.......#.#...#...................#...#......#..............#...#....#.................#."
"...#..#...........#.............#..........##..............................###...........#.#.....##.......#.............#.........."
"...##.....................##...#..#.....#.........#.#....#.#.....................#..............#.#...#...#......#..............#.."
"......##................#.................#.#........#.#..#................#............#......#.#..............#...............#.."
".......#...........#.................................##..................#...#........#.......#..##...##...........#.........#....."
"..............#........#.............#..........#...............#..#.......#.........#..#...............#......#..#.........##.#..."
".....#..........................................#...............#....#......#..#................................#...............#.."
"...............#.......#..#.........#......#..................#........#................#.#...........#....##......#............#.."
"...........................#.....##.........#...#...........#........#..#................#.#.#............#..#...#.....#..........."
"................#.....#..#.#......#.............#.....#...........##....#...#.#.....#.........#...................................."
"....................................#...........#..............#................#............#..#...............#.##..#.##........."
".........#.#..............#........#.........#..#...#........#............##......##.......#....##.............#..................."
"......................#............................#........................#.#..#..........#......................................"
"........#...........#.#....#.........#.....#..........#..#.#..............#.......................#..#................#.#.........."
".................................................................S................................................................."
".........#.....#..#..........#.....#...........#...............##..#...............#.##....#...........#........#.#....#....#......"
".........##...#......#..#.#................#...........#..#...........#...#....#..............#......#..#.................##......."
".....................##.....................##...#.......#......#.............................#..#................................."
"........................#..............#....#.................#....#...........#.................#...#.........#........#.........."
".........#..#.#...#.#..................#..............#.#...###....#......#......#.#....#..##..............#............#.........."
"..#.......#...#..............#...#..##............#.........#......#.#....#.#..........................#......#..#.....#..........."
"..#........#......##.............................#..............#..#....................##.......#....#..#..#..........#..........."
".....................#.....#...........#.##................#.#....#.#.#............#...#..##.............#.....##.................."
"..##............#........#........#...#......#..........##.................#...#.#..........#...................................##."
"...#.............#....#...#..#........#.........#......#..................#..#..#..........#.....#........#.#....##............#..."
"...#.............#...............................#.......#....#..........#..........................##......##...#.............#..."
"....#................#..#.#................#.....#.......#..................#.......................#.#............................"
"....#.#..............#..#.........#..#..#................#..#...#.#..............#......#...................#......................"
".#......#....................#.................#........##......#......##..........#...............#..##.#.....#.............#....."
"...##................#..........#......##.....#........#...#..................#........#......#....#..#.....#......................"
"......#..................#......#.......#.......#..............#......#.........#.......#..#.#.#...##.....#.............#.........."
".#...................#...#....#......#.#.....#.....#..................#.#......#.......#.....#..#......................#.....#....."
"...#......................#.......#..#.........#............#...#......##..........#..............................................."
"...#..#........#........#...........#.#...#...#.#..#.#...#..................#........#........#.#.##...#...........#..............."
"........#.......................#.............#....#...##.........#....................................#..............#...#........"
"...#...........##........#..#.......#...............................#..................#.....#.......#.#.........#................."
"..........#...............#.###...................#..................................#.....#...#................##...............#."
"..#......#..........................#...........................#..................#..#........#....##...................##......#."
"....#...........#..#..........................#......###................#...........................#.........#.#........#.#......."
"...#...#..#........#...............#...........#.......#........................##..#...............#............#...........#....."
".....#..........................#..#........#.......#......#......#..........#..#.....#.....#..#.................#........#........"
"....#...##.......................#...#.....#.....................................##.#..#....#....#................#................"
"..#.....##.........#..............#.#................#.........#...#.................#.........#..............................#...."
"............#...........#........#........................#.#.......#..#..#.........##...................#......##.#.......#......."
".........#......#......#............#.....#...##...#...............................#.....#..............##............#..#.....##.."
"...........................#.................#...........#.........#....#.#.#....#......#..#....................#......#..........."
"....#.#..............................#......#..........#...........#....#.............#.#..............................#.....#..#.."
"...........#...........#.............##....#......#.........#................#........#...............................#............"
"...#........#.#....#.....................#..........#.......#...#.........#..........................##........#.#.#...##.........."
"....#.#....#.........#.......#....................#...........#..........#....#......................#.............#.....#..#....#."
"..........#................................#......#....#......#.................................................#.................."
".............#................................#...#.##.#.....#.......#....#............###.......#........##......................."
"..........#......##.............#.........#............................#.#..#.......................................#.....#......#."
"...#.....#.......#............#.............#.#...#.....#.............#..#..........##.......................#....................."
"..........................#......#..................#..#........#............#.......##......................###.......#.....#....."
"............#.#....#.#................................##......#..............#..#.#........................#......#...#...#........"
"......##..........#......###...#......................#.........#.#............#..............#......#..............#.......#......"
"............#........#.....#........#..#.......#...#...................#.....#..................##.............#.................#."
"........#.#........##..................................#......#......................................#.....................#.#...#."
".#.......##......#.....#..........#................#...................##..#...............#.......##....................#........."
"...#..#..#.............................#...................#................#....................................#........#........"
".....#....................................#.........##.............#...........................#..................................."
"............................#....#......#...................#..................................#...........................##......"
"...............#...#..#...#.###.#...........#..............#..........#...............##........#.##.#....#.#.............##.....#."
"...........#.##......#...#.#.........#.#.#...#.........................................#..........#.............#.#.............#.."
"........#...............#........#........................#.#......#......#......................#...........#.........#.#...#....."
"....#..#.............#......................#...................#.....##...............#...#........#.................#............"
"............#......#...#.....#..........#....#...............##.....##..#.........#....#..#.......#...#..#........................."
"......#...........#.......#...#.#.....#...#......#...........#......#................#................#....#.#...#................."
".......#.#...#.......#......#.................................#..............................#...........#.............#.........#."
"...................................#.....#.........#.............................#..#............#...................#...#........."
"...............#......#...........................#................#...............##...........#......#........#....##......#.#..."
"...............#....................##....#...#.....#.................................#..#.............#.#..#.....#..#.#..........."
".............................#......##..#........................................##....#.................#......#....#...#........."
"......#.#.#...............#.......#............................................................#................#..........#..#...."
"...#.#...........#..#......#....###...............#..#..#......................#....#..............#......#................#......."
".......................#....#.....#..#.##.#..........#.....................#..................................#....####.##........."
"......#..........##...#...........................#....#.................#........#.......................#.................#..#..."
".................#..#...................#..#...#...##...#..................#..........#.#....#..#...........................#....#."
"..................................................................................................................................."
]

# Number of steps to consider
total_steps = 26501365

# Get the number of possible locations of freedom
result = count_reachable_positions(mars_map, total_steps)
print("Number of possible locations of freedom:", result)
